<!DOCTYPE html>
<html>
<body>
    <script>
    var xhr;
    if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
    } else if (window.ActiveXObject) {
       xhr = new ActiveXObject("Microsoft.XMLHTTP");
   }

    function log (msg) {
        document.getElementById('m').innerHTML += msg + "<br>";
    }

    function handleReply(resp) {
        log ('handling reply');
        var reply; 
        log(JSON.stringify(resp));
        if (resp.status != 200) {
            reply = {'status': false};
        }
//        reply['callback_id'] = cmd.callback_id;
//        event.source.postMessage(JSON.stringify(reply),
//            event.origin);
    }


    window.addEventListener('message', function(event) {
        console.debug(event.origin);
        log(event.origin);
        log(event.data);
        var cmd = JSON.parse(event.data);
        switch (cmd.cmd) {
            case 'aliases':
                xhr.open('GET', '/origin/' + cmd.args.origin);
            case 'loggedin':
                xhr.open('GET', '/user/');
               break;

            default:
                event.source.postMessage(JSON.stringify({'status': false,
                    'callback_id': cmd.callback_id}), 
                    event.origin);
                return false;
            }
        log('setting header');
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.onreadystatechange = handleReply;
        log('sending event');
        xhr.send();
       
    }, false);
</script>
<div id="m"></div>
</body>
</html>
